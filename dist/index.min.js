"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _=require("lodash"),s=require("underscore.string"),pluralize=require("pluralize"),moment=require("moment"),math=require("mathjs"),accounting=require("accounting"),vn2w=require("v-number-to-words"),v_utilities_1=require("v-utilities"),VTools=function(){function t(){}return Object.defineProperty(t,"ROUND_TO_DEFAULT",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ALPHABET",{get:function(){return["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ROMAN_MAP",{get:function(){return{1000:"M",900:"CM",500:"D",400:"CD",100:"C",90:"XC",50:"L",40:"XL",10:"X",9:"IX",5:"V",4:"IV",1:"I"}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ORDERED_ROMAN_MAP",{get:function(){return[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PERIOD_FREQUENCY_LEGEND",{get:function(){return{1:"One year",2:"Six months",3:"Four months",4:"Three months",6:"Two months",8:"Month and a half",12:"One month",24:"Half month",26:"Two weeks",52:"Week",364:"One day",365:"One day",366:"One day"}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANNUAL_FREQUENCY_TO_LABEL",{get:function(){return{1:"Annual",4:"Quarterly",12:"Monthly"}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PERIOD_FREQ_OPTIONS",{get:function(){return{Annual:1,"Semi-Annual":2,Quarter:4,Month:8}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ALL_FISCAL_PERIODS",{get:function(){return["N/A","FY","FYTD","Q1","Q2","Q3","Q4","H1","H2","9M","T1M","T3M","T9M","TSM","TTM","M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12","ASOF"]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PERIODLY",{get:function(){return["annually","semi-annually","quarterly","bi-monthly","monthly","semi-monthly","bi-weekly","weekly","daily","hourly"]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PERIODS",{get:function(){return["years","semi-years","quarters","bi-months","months","semi-months","bi-weeks","weeks","days","hours","minutes","seconds"]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SINGULAR_PERIODS",{get:function(){return _.map(t.PERIODS,function(t){return pluralize(t,1)})},enumerable:!0,configurable:!0}),t.pluralize=function(t){return pluralize.apply(this,arguments)},t.ambipluralize=function(e){return s.isBlank(e)?e:(e=t.pluralize(e),/ies$/i.test(e)?e=e.replace(/ies$/i,"(ies)"):/s$/i.test(e)&&(e=e.replace(/s$/i,"(s)")),e)},t.normalizeString=function(t){return(t||"").toString().replace(/[\s\'\.\,\:\;\/\(\)\[\]\-\#\@\!\$\%\^\&\*\+\=\"\?\<\>\~\`]+/g,"").replace(/^\d/,function(t){return"pre_"+t[0]})},t.parseZeroPaddedInt=function(t){if(s.isBlank(t)||0===t||"0"===t||s.isBlank(t.toString().replace(/0/g,"")))return 0;t=t.toString();var e=t.search(/(?!0)/);return parseInt(t.slice(e,t.length),10)},t.stringToDecimal=function(t){return parseFloat((t||0).toString().trim().replace(/[^\d\.]/g,""))},t.stringToInteger=function(e){return parseInt(t.stringToDecimal(e).toString(),10)},t.variableCurrency=function(e,r){if(e=v_utilities_1.VUtilities.makeString(e),t.roundToDecimal(parseFloat(e),2)===parseFloat(e))return accounting.formatMoney(e,r);var i=t.decimalToStr(parseFloat(e)),n=i?(i.split(".")[1]||"").length:2;return 1===n&&(n=2),accounting.formatMoney(e,r,n)},t.variableInteger=function(e){if(e=v_utilities_1.VUtilities.makeString(e),!t.isNumeric(e))return e;if(t.roundToDecimal(parseFloat(e),0)===parseFloat(e))return accounting.formatNumber(e);var r=t.decimalToStr(parseFloat(e));if(!r)return r;var i=r.split(".");return accounting.formatNumber(i[0]||"0")+"."+(i[1]||"00")},t.noExponentsStr=function(t){t=v_utilities_1.VUtilities.makeString(t);var e=parseFloat(t),r=String(e).split(/[eE]/);if(1===r.length)return r[0];var i="",n=e<0?"-":"",a=r[0].replace(".",""),o=Number(r[1])+1;if(o<0){for(i=n+"0.";o++;)i+="0";return i+a.replace(/^\-/,"")}for(o-=a.length;o--;)i+="0";return a+i},t.decimalToStr=function(e,r){void 0===r&&(r=t.ROUND_TO_DEFAULT),e=v_utilities_1.VUtilities.makeString(e);var i=parseFloat(e),n=t.noExponentsStr(i);if(r=t.isNumeric(r)?parseInt(r.toString(),10):t.ROUND_TO_DEFAULT,"NaN"===n)return null;var a=t.reverse(n).split("").findIndex(function(t){return 0!==parseInt(t,10)||"."===t});return-1===a?"0.00":(n=n.substring(0,n.length+a),!/\./.test(n)||(_.last(n.split("."))||"").length<3||"."===n.slice(-1)?n=parseFloat(n).toFixed(2):(!/\./.test(n)||(_.last(n.split("."))||"").length>7||"."===n.slice(-1))&&(n=t.roundToDecimal(parseFloat(n),r).toString()),n)},t.decimalToPercStr=function(e){return(t.decimalToStr(parseFloat(math.multiply(v_utilities_1.VUtilities.parseBigOrZero(e),math.bignumber(100)).toString()))||"0.0")+"%"},t.percToDecimal=function(t){return parseFloat(math.divide(v_utilities_1.VUtilities.parseBigOrZero(t),math.bignumber(100)).toString())},t.percentThreshold=function(e,r){if(!t.isNumeric(e))return e;e=v_utilities_1.VUtilities.makeString(e);return 50===parseFloat(e)?"a majority":66.66===t.roundToDecimal(parseFloat(e),2)||66.67===t.roundToDecimal(parseFloat(e),2)?"at least two-thirds":33.3===t.roundToDecimal(parseFloat(e),1)?"at least one-third":"at least "+e+"%"},t.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.decimalToPercentage=function(t,e){return void 0===e&&(e=2),(100*(parseFloat(v_utilities_1.VUtilities.makeString(t))||0)).toFixed(e)},t.roundToDecimal=function(e,r){if(void 0===r&&(r=2),r=t.isNumeric(r)?parseInt(v_utilities_1.VUtilities.makeString(r),10):2,t.isNumeric(e)){var i=v_utilities_1.VUtilities.parseBigOrZero(e),n=math.divide(math.round(math.multiply(i,math.pow(10,r))),math.pow(10,r));return r>=0&&(n=math.format(n,{notation:"fixed",precision:r})),n=parseFloat(n.toString())}return parseFloat(v_utilities_1.VUtilities.makeString(e))},t.numberToWords=function(t){return vn2w.numberToWords(t)},t.coerceToDate=function(t,e){try{return moment.utc(v_utilities_1.VUtilities.enumDate(t)||0)}catch(e){return t}},t.formatDate=function(t,e){void 0===e&&(e={utc:!1});var r;return t&&t.toString().length>0?(r="number"==typeof t?moment.unix(t):t.toString().trim().match(/^\d{4}-\d{2}\d{2}$/)?moment(t,"YYYY-MM-DD"):t.toString().trim().match(/^\d{8}$/)?moment(t,"YYYYMMDD"):moment(t),e.utc?r.utc().format("LL"):r.format("LL")):t},t.formatDateSentence=function(e,r){if(s.isBlank(e))return e;e=t.coerceToDate(e,r);try{return moment(e).format("Do")+" day of "+moment(e).format("MMMM, YYYY")}catch(t){return e}},t.labelize=function(e){return s.titleize(t.hintize(e))},t.hintize=function(t){return s.capitalize(s.underscored((t||"").toString()).split(/\_|(\W)/).join(" ").replace(/\s+/g," "))},t.titleize=function(t){return s.isBlank(t)?t:s.titleize(t.toString().trim())},t.toRoman=function(e){e=e||0;var r="";return 0===e?r:(_.each(t.ORDERED_ROMAN_MAP,function(t){var i=t[0],n=t[1],a=Math.floor(e/i),o=e%i;r+=n.repeat(a),e=o}),r)},t.toRomanette=function(e){return e=e||0,t.toRoman(e).toLowerCase()},t.toAlpha=function(e,r){e=parseInt(v_utilities_1.VUtilities.makeString(e)||"0",10),r=r||"";for(;e>0;){var i=Math.floor((e-1)/26),n=(e-1)%26;r=t.ALPHABET[n]+r,e=i}return r},t.toOrdinal=function(t){var e=["th","st","nd","rd"],r=t%100;return t+(e[(r-20)%10]||e[r]||e[0])},t.joinArray=function(e){if(e&&t.isArray(e)){var r=_.filter(e,function(t){return!s.isBlank(t)});return t.smart_array_values(r).join(", ")}},t.joinArray2d=function(e){if(e&&t.isArray(e))return t.smart_array2d_values(e).map(function(e){return t.isArray(e)?e.join(" - "):e.toString()}).join("; ")},t.joinArrayOfHashesValues=function(e){if(e&&t.isArray(e))return t.smart_array_of_hash_values(e).map(function(e){return t.isObject(e)?_.map(e,function(e,r){return t.smartFormatValue(e)}).join(", "):t.smartFormatValue(e)}).join("; ")},t.hashToLines=function(e){return _.map(t.smart_hash_values(e),function(t,e){return v_utilities_1.VUtilities.makeString(e)+": "+v_utilities_1.VUtilities.makeString(t)})},t.hashesToLines=function(e){return t.isArray(e)?e.map(function(e){return t.hash_to_lines(e)}).join("; "):e},t.smartRecursiveFormat=function(e){var r;return e&&t.isObject(e)?(r=_.defaults({},e),_.each(e,function(e,i){r[i]=t.smartRecursiveFormat(e)})):e&&t.isArray(e)?(r=[],e.forEach(function(e){r.push(t.smartRecursiveFormat(e))})):r=t.smartFormatValue(e),r},t.smartFormatValue=function(e){var r=e;return t.isDate(e)||moment.isMoment(e)||"string"==typeof e&&/^\d\d\d\d\-\d\d\-\d\d$/.test(e)?r=t.formatDate(e):"number"==typeof e&&(r=t.variableInteger(e)),r},t.valueOrHolder=function(t){return s.isBlank(t)||0===t.toString().replace(/\s/gi,"").length?"_________________":t},t.arrayToHumanList=function(e,r){if(r=r||{},!t.isArray(e))return e;_.defaults(r,{separator:",",junctive:"and",serial:null});var i=r.serial||";"===r.separator&&!t.isFalse(r.serial)?r.separator+" ":" ",n=e.length,a="";return _.each(e,function(t,e){0!==e&&(a+=2===n?" "+r.junctive+" ":n>2&&e<n-1?r.separator+" ":i+r.junctive+" "),a+=t}),a},t.jsFormat=function(e,r){return t.isBlank(r)?t.coerceToString(e):(r=[].concat(r||[]),_.each(r,function(r){try{e=t.hasOwnProperty(r)?t[r](e):e}catch(r){return t.coerceToString(e)}}),t.coerceToString(e))},t.jsFormatVField=function(e,r,i){if(!r||t.isBlank(i))return e;var n=[];return(i||[]).forEach(function(t){return n=n.concat((r||{})[t]||[])}),s.isBlank(n)?e:t.jsFormat(e,n)},t.jsFormatVFields=function(e,r,i){if(s.isBlank(e)||!r)return e;var n={};return _.each(e,function(e,a){var o=(r||{})[a]||{};n[a]=t.jsFormatVField(e,o,i)}),n},t.jsInputProcess=function(e,r,i){return t.jsFormatVFields(e,r,["jsInputProcessors"])},t.jsDisplay=function(e,r){return t.jsFormatVFields(e,r,["js_formatters"])},t.jsInputDisplay=function(e,r){return t.jsFormatVFields(e,r,["jsInputProcessors","js_formatters"])},t.isBlank=v_utilities_1.VUtilities.isBlank,t.isObject=v_utilities_1.VUtilities.isObject,t.isArray=v_utilities_1.VUtilities.isArray,t.isDate=v_utilities_1.VUtilities.isDate,t.isString=v_utilities_1.VUtilities.isString,t.isNumeric=v_utilities_1.VUtilities.isNumeric,t.isTrue=v_utilities_1.VUtilities.isTrue,t.isFalse=v_utilities_1.VUtilities.isFalse,t.isTrueOrFalse=v_utilities_1.VUtilities.isTrueOrFalse,t.coerceToString=v_utilities_1.VUtilities.coerceToString,t.reverse=v_utilities_1.VUtilities.reverse,t.string_to_decimal=t.stringToDecimal,t.string_to_integer=t.stringToInteger,t.join_array=t.joinArray,t.join_array2d=t.joinArray2d,t.join_array_of_hashes_values=t.joinArrayOfHashesValues,t.hash_to_lines=t.hashToLines,t.hashes_to_lines=t.hashesToLines,t.smart_array_values=t.smartRecursiveFormat,t.smart_hash_values=t.smartRecursiveFormat,t.smart_array2d_values=t.smartRecursiveFormat,t.smart_array_of_hash_values=t.smartRecursiveFormat,t.smart_format_value=t.smartFormatValue,t}();exports.VTools=VTools,exports.default=VTools;
