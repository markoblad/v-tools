"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _=require("lodash"),s=require("underscore.string"),pluralize=require("pluralize"),moment=require("moment"),math=require("mathjs"),accounting=require("accounting"),vn2w=require("v-number-to-words"),VTools=function(){function r(){}return Object.defineProperty(r,"ROUND_TO_DEFAULT",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ALPHABET",{get:function(){return["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ROMAN_MAP",{get:function(){return{1000:"M",900:"CM",500:"D",400:"CD",100:"C",90:"XC",50:"L",40:"XL",10:"X",9:"IX",5:"V",4:"IV",1:"I"}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ORDERED_ROMAN_MAP",{get:function(){return[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIOD_FREQUENCY_LEGEND",{get:function(){return{1:"One year",2:"Six months",3:"Four months",4:"Three months",6:"Two months",8:"Month and a half",12:"One month",24:"Half month",26:"Two weeks",52:"Week",364:"One day",365:"One day",366:"One day"}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ANNUAL_FREQUENCY_TO_LABEL",{get:function(){return{1:"Annual",4:"Quarterly",12:"Monthly"}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIOD_FREQ_OPTIONS",{get:function(){return{Annual:1,"Semi-Annual":2,Quarter:4,Month:8}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ALL_FISCAL_PERIODS",{get:function(){return["N/A","FY","FYTD","Q1","Q2","Q3","Q4","H1","H2","9M","T1M","T3M","T9M","TSM","TTM","M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12","ASOF"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIODLY",{get:function(){return["annually","semi-annually","quarterly","bi-monthly","monthly","semi-monthly","bi-weekly","weekly","daily","hourly"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIODS",{get:function(){return["years","semi-years","quarters","bi-months","months","semi-months","bi-weeks","weeks","days","hours","minutes","seconds"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"SINGULAR_PERIODS",{get:function(){return _.map(r.PERIODS,function(r){return pluralize(r,1)})},enumerable:!0,configurable:!0}),r.isBlank=function(e){return null==e||void 0==e||("string"==typeof e||"number"==typeof e?s.isBlank(e.toString()):r.isArray(e)?0===e.length:r.isObject(e)?0===Object.getOwnPropertyNames(e).length:s.isBlank(r.makeString(e)))},r.isObject=function(r){return"[object Object]"===Object.prototype.toString.call(r)},r.isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)},r.isDate=function(r){return"[object Date]"===Object.prototype.toString.call(r)},r.isString=function(r){return"string"==typeof r},r.isNumeric=function(e){return!r.isObject(e)&&!r.isArray(e)&&!isNaN(parseFloat(e))&&isFinite(e)},r.isTrue=function(r){if(void 0===r||null===r)return!1;var e=["yes","y","true","t","1","on"];return _.includes(e,r.toString().toLowerCase())},r.isFalse=function(r){if(void 0===r||null===r)return!1;var e=["no","n","false","f","0","off"];return _.includes(e,r.toString().toLowerCase())},r.isTrueOrFalse=function(e){return r.isTrue(e)||r.isFalse(e)},r.eachSlice=function(r,e,t){void 0===e&&(e=1);for(var n=0,a=r.length;n<a;n+=e)t(r.slice(n,n+e))},r.arraySum=function(e){return e&&r.isArray(e)?_.reduce(e,function(r,e){var t=typeof e;return!e||"string"!==t&&"number"!==t||!isFinite(e)&&e!==1/0?r:r+parseFloat(e)},0):0},r.arrayItemCounts=function(r){return _.reduce(r||[],function(r,e){return r[e]=r[e]||0,r[e]+=1,r},{})},r.hasRangeOverlap=function(e,t,n){return void 0===n&&(n={}),r.isTrue(n.sort)&&(e=e.sort(),t=t.sort()),e&&t&&2===e.length&&2===t.length&&(r.isTrue(n.strict)?e[0]!==e[1]&&(e[0]<t[1]&&e[1]>t[0]||t[0]<e[1]&&t[1]>e[0]):e[0]<=t[1]&&t[0]<=e[1])},r.makeString=function(r){return null==r?"":""+r},r.coerceToString=function(r){return _.some(["[object Undefined]","[object Null]"],function(e){return Object.prototype.toString.call(r)===e})?"":r.toString()},r.pluralize=function(r){return pluralize.apply(this,arguments)},r.reverse=function(r){return r.split("").reverse().join("")},r.ambipluralize=function(e){return s.isBlank(e)?e:(e=r.pluralize(e),/ies$/i.test(e)?e=e.replace(/ies$/i,"(ies)"):/s$/i.test(e)&&(e=e.replace(/s$/i,"(s)")),e)},r.normalizeString=function(r){return(r||"").toString().replace(/[\s\'\.\,\:\;\/\(\)\[\]\-\#\@\!\$\%\^\&\*\+\=\"\?\<\>\~\`]+/g,"").replace(/^\d/,function(r){return"pre_"+r[0]})},r.parseZeroPaddedInt=function(r){if(s.isBlank(r)||0===r||"0"===r||s.isBlank(r.toString().replace(/0/g,"")))return 0;r=r.toString();var e=r.search(/(?!0)/);return parseInt(r.slice(e,r.length),10)},r.stringToDecimal=function(r){return parseFloat((r||0).toString().trim().replace(/[^\d\.]/g,""))},r.stringToInteger=function(e){return parseInt(r.stringToDecimal(e).toString(),10)},r.parseBigOrZero=function(e){return math.bignumber(r.isNumeric(e)?e:0)},r.variableCurrency=function(e,t){if(e=r.makeString(e),r.roundToDecimal(parseFloat(e),2)===parseFloat(e))return accounting.formatMoney(e,t);var n=r.decimalToStr(parseFloat(e)),a=n?(n.split(".")[1]||"").length:2;return 1===a&&(a=2),accounting.formatMoney(e,t,a)},r.variableInteger=function(e){if(e=r.makeString(e),!r.isNumeric(e))return e;if(r.roundToDecimal(parseFloat(e),0)===parseFloat(e))return accounting.formatNumber(e);var t=r.decimalToStr(parseFloat(e));if(!t)return t;var n=t.split(".");return accounting.formatNumber(n[0]||"0")+"."+(n[1]||"00")},r.noExponentsStr=function(e){e=r.makeString(e);var t=parseFloat(e),n=String(t).split(/[eE]/);if(1===n.length)return n[0];var a="",i=t<0?"-":"",o=n[0].replace(".",""),u=Number(n[1])+1;if(u<0){for(a=i+"0.";u++;)a+="0";return a+o.replace(/^\-/,"")}for(u-=o.length;u--;)a+="0";return o+a},r.decimalToStr=function(e,t){void 0===t&&(t=r.ROUND_TO_DEFAULT),e=r.makeString(e);var n=parseFloat(e),a=r.noExponentsStr(n);if(t=r.isNumeric(t)?parseInt(t.toString(),10):r.ROUND_TO_DEFAULT,"NaN"===a)return null;var i=r.reverse(a).split("").findIndex(function(r){return 0!==parseInt(r,10)||"."===r});return-1===i?"0.00":(a=a.substring(0,a.length+i),!/\./.test(a)||(_.last(a.split("."))||"").length<3||"."===a.slice(-1)?a=parseFloat(a).toFixed(2):(!/\./.test(a)||(_.last(a.split("."))||"").length>7||"."===a.slice(-1))&&(a=r.roundToDecimal(parseFloat(a),t).toString()),a)},r.decimalToPercStr=function(e){return(r.decimalToStr(parseFloat(math.multiply(r.parseBigOrZero(e),math.bignumber(100)).toString()))||"0.0")+"%"},r.percToDecimal=function(e){return parseFloat(math.divide(r.parseBigOrZero(e),math.bignumber(100)).toString())},r.percentThreshold=function(e,t){if(!r.isNumeric(e))return e;e=r.makeString(e);return 50===parseFloat(e)?"a majority":66.66===r.roundToDecimal(parseFloat(e),2)||66.67===r.roundToDecimal(parseFloat(e),2)?"at least two-thirds":33.3===r.roundToDecimal(parseFloat(e),1)?"at least one-third":"at least "+e+"%"},r.numberWithCommas=function(r){return r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},r.decimalToPercentage=function(e,t){return void 0===t&&(t=2),(100*(parseFloat(r.makeString(e))||0)).toFixed(t)},r.roundToDecimal=function(e,t){if(void 0===t&&(t=2),t=r.isNumeric(t)?parseInt(r.makeString(t),10):2,r.isNumeric(e)){var n=r.parseBigOrZero(e),a=math.divide(math.round(math.multiply(n,math.pow(10,t))),math.pow(10,t));return t>=0&&(a=math.format(a,{notation:"fixed",precision:t})),a=parseFloat(a.toString())}return parseFloat(r.makeString(e))},r.numberToWords=function(r){return vn2w.numberToWords(r)},r.enumDate=function(r){return s.isBlank(r)?null:"number"==typeof r?r:parseInt(moment.utc(r).format("x"),10)},r.coerceToDate=function(e,t){try{return moment.utc(r.enumDate(e)||0)}catch(r){return e}},r.formatDate=function(r,e){void 0===e&&(e={utc:!1});var t;return r&&r.toString().length>0?(t="number"==typeof r?moment.unix(r):r.toString().trim().match(/^\d{4}-\d{2}\d{2}$/)?moment(r,"YYYY-MM-DD"):r.toString().trim().match(/^\d{8}$/)?moment(r,"YYYYMMDD"):moment(r),e.utc?t.utc().format("LL"):t.format("LL")):r},r.formatDateSentence=function(e,t){if(s.isBlank(e))return e;e=r.coerceToDate(e,t);try{return moment(e).format("Do")+" day of "+moment(e).format("MMMM, YYYY")}catch(r){return e}},r.labelize=function(e){return s.titleize(r.hintize(e))},r.hintize=function(r){return s.capitalize(s.underscored((r||"").toString()).split(/\_|(\W)/).join(" ").replace(/\s+/g," "))},r.titleize=function(r){return s.isBlank(r)?r:s.titleize(r.toString().trim())},r.toRoman=function(e){e=e||0;var t="";return 0===e?t:(_.each(r.ORDERED_ROMAN_MAP,function(r){var n=r[0],a=r[1],i=Math.floor(e/n),o=e%n;t+=a.repeat(i),e=o}),t)},r.toRomanette=function(e){return e=e||0,r.toRoman(e).toLowerCase()},r.toAlpha=function(e,t){e=parseInt(r.makeString(e)||"0",10),t=t||"";for(;e>0;){var n=Math.floor((e-1)/26),a=(e-1)%26;t=r.ALPHABET[a]+t,e=n}return t},r.toOrdinal=function(r){var e=["th","st","nd","rd"],t=r%100;return r+(e[(t-20)%10]||e[t]||e[0])},r.joinArray=function(e){if(e&&r.isArray(e)){var t=_.filter(e,function(r){return!s.isBlank(r)});return r.smart_array_values(t).join(", ")}},r.joinArray2d=function(e){if(e&&r.isArray(e))return r.smart_array2d_values(e).map(function(e){return r.isArray(e)?e.join(" - "):e.toString()}).join("; ")},r.joinArrayOfHashesValues=function(e){if(e&&r.isArray(e))return r.smart_array_of_hash_values(e).map(function(e){return r.isObject(e)?_.map(e,function(e,t){return r.smartFormatValue(e)}).join(", "):r.smartFormatValue(e)}).join("; ")},r.hashToLines=function(e){return _.map(r.smart_hash_values(e),function(e,t){return r.makeString(t)+": "+r.makeString(e)})},r.hashesToLines=function(e){return r.isArray(e)?e.map(function(e){return r.hash_to_lines(e)}).join("; "):e},r.smartRecursiveFormat=function(e){var t;return e&&r.isObject(e)?(t=_.defaults({},e),_.each(e,function(e,n){t[n]=r.smartRecursiveFormat(e)})):e&&r.isArray(e)?(t=[],e.forEach(function(e){t.push(r.smartRecursiveFormat(e))})):t=r.smartFormatValue(e),t},r.smartFormatValue=function(e){var t=e;return r.isDate(e)||moment.isMoment(e)||"string"==typeof e&&/^\d\d\d\d\-\d\d\-\d\d$/.test(e)?t=r.formatDate(e):"number"==typeof e&&(t=r.variableInteger(e)),t},r.valueOrHolder=function(r){return s.isBlank(r)||0===r.toString().replace(/\s/gi,"").length?"_________________":r},r.arrayToHumanList=function(e,t){if(t=t||{},!r.isArray(e))return e;_.defaults(t,{separator:",",junctive:"and",serial:null});var n=t.serial||";"===t.separator&&!r.isFalse(t.serial)?t.separator+" ":" ",a=e.length,i="";return _.each(e,function(r,e){0!==e&&(i+=2===a?" "+t.junctive+" ":a>2&&e<a-1?t.separator+" ":n+t.junctive+" "),i+=r}),i},r.jsFormat=function(e,t){return r.isBlank(t)?r.coerceToString(e):(t=[].concat(t||[]),_.each(t,function(t){try{e=r.hasOwnProperty(t)?r[t](e):e}catch(t){return r.coerceToString(e)}}),r.coerceToString(e))},r.jsFormatVField=function(e,t,n){if(!t||r.isBlank(n))return e;var a=[];return(n||[]).forEach(function(r){return a=a.concat((t||{})[r]||[])}),s.isBlank(a)?e:r.jsFormat(e,a)},r.jsFormatVFields=function(e,t,n){if(s.isBlank(e)||!t)return e;var a={};return _.each(e,function(e,i){var o=(t||{})[i]||{};a[i]=r.jsFormatVField(e,o,n)}),a},r.jsInputProcess=function(e,t,n){return r.jsFormatVFields(e,t,["jsInputProcessors"])},r.jsDisplay=function(e,t){return r.jsFormatVFields(e,t,["js_formatters"])},r.jsInputDisplay=function(e,t){return r.jsFormatVFields(e,t,["jsInputProcessors","js_formatters"])},r.string_to_decimal=r.stringToDecimal,r.string_to_integer=r.stringToInteger,r.join_array=r.joinArray,r.join_array2d=r.joinArray2d,r.join_array_of_hashes_values=r.joinArrayOfHashesValues,r.hash_to_lines=r.hashToLines,r.hashes_to_lines=r.hashesToLines,r.smart_array_values=r.smartRecursiveFormat,r.smart_hash_values=r.smartRecursiveFormat,r.smart_array2d_values=r.smartRecursiveFormat,r.smart_array_of_hash_values=r.smartRecursiveFormat,r.smart_format_value=r.smartFormatValue,r}();exports.VTools=VTools,exports.default=VTools;
