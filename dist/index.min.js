"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _=require("lodash"),s=require("underscore.string"),pluralize=require("pluralize"),moment=require("moment"),mathjs=require("mathjs"),accounting=require("accounting"),vn2w=require("v-number-to-words"),v_utilities_1=require("v-utilities"),VTools=function(){function o(){}return Object.defineProperty(o,"ROUND_TO_DEFAULT",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALPHABET",{get:function(){return["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ROMAN_MAP",{get:function(){return{1e3:"M",900:"CM",500:"D",400:"CD",100:"C",90:"XC",50:"L",40:"XL",10:"X",9:"IX",5:"V",4:"IV",1:"I"}},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ORDERED_ROMAN_MAP",{get:function(){return[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]]},enumerable:!0,configurable:!0}),Object.defineProperty(o,"PERIOD_FREQUENCY_LEGEND",{get:function(){return{1:"One year",2:"Six months",3:"Four months",4:"Three months",6:"Two months",8:"Month and a half",12:"One month",24:"Half month",26:"Two weeks",52:"Week",364:"One day",365:"One day",366:"One day"}},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ANNUAL_FREQUENCY_TO_LABEL",{get:function(){return{1:"Annual",4:"Quarterly",12:"Monthly"}},enumerable:!0,configurable:!0}),Object.defineProperty(o,"PERIOD_FREQ_OPTIONS",{get:function(){return{Annual:1,"Semi-Annual":2,Quarter:4,Month:8}},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALL_FISCAL_PERIODS",{get:function(){return["N/A","FY","FYTD","Q1","Q2","Q3","Q4","H1","H2","9M","T1M","T3M","T9M","TSM","TTM","M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12","ASOF"]},enumerable:!0,configurable:!0}),Object.defineProperty(o,"PERIODLY",{get:function(){return["annually","semi-annually","quarterly","bi-monthly","monthly","semi-monthly","bi-weekly","weekly","daily","hourly"]},enumerable:!0,configurable:!0}),Object.defineProperty(o,"PERIODS",{get:function(){return["years","semi-years","quarters","bi-months","months","semi-months","bi-weeks","weeks","days","hours","minutes","seconds"]},enumerable:!0,configurable:!0}),Object.defineProperty(o,"SINGULAR_PERIODS",{get:function(){return _.map(o.PERIODS,function(t){return pluralize(t,1)})},enumerable:!0,configurable:!0}),o.bool=function(t){return o.isTrue(t)?"Yes":"No"},o.yesCheckbox=function(t){return o.isTrue(t)?"Yes":null},o.check=function(t){return o.isTrue(t)?"✓":"✘"},o.pluralize=function(t){return pluralize.apply(this,arguments)},o.ambipluralize=function(t){return s.isBlank(t)||(t=o.pluralize(t),/ies$/i.test(t)?t=t.replace(/ies$/i,"(ies)"):/s$/i.test(t)&&(t=t.replace(/s$/i,"(s)"))),t},o.normalizeString=function(t){return(t||"").toString().replace(/[\s\'\.\,\:\;\/\(\)\[\]\-\#\@\!\$\%\^\&\*\+\=\"\?\<\>\~\`]+/g,"").replace(/^\d/,function(t){return"pre_"+t[0]})},o.parseZeroPaddedInt=function(t){if(s.isBlank(t)||0===t||"0"===t||s.isBlank(t.toString().replace(/0/g,"")))return 0;var e=(t=t.toString()).search(/(?!0)/);return parseInt(t.slice(e,t.length),10)},o.stringToDecimal=function(t){return parseFloat((t||0).toString().trim().replace(/[^\d\.]/g,""))},o.stringToInteger=function(t){return parseInt(o.stringToDecimal(t).toString(),10)},o.variableCurrency=function(t,e){if(t=v_utilities_1.VUtilities.makeString(t),o.roundToDecimal(parseFloat(t),2)===parseFloat(t))return accounting.formatMoney(t,e);var r=o.decimalToStr(parseFloat(t)),i=r?(r.split(".")[1]||"").length:2;return 1===i&&(i=2),accounting.formatMoney(t,e,i)},o.variableInteger=function(t){if(t=v_utilities_1.VUtilities.makeString(t),!o.isNumeric(t))return t;if(o.roundToDecimal(parseFloat(t),0)===parseFloat(t))return accounting.formatNumber(t);var e=o.decimalToStr(parseFloat(t));if(!e)return e;var r=e.split(".");return accounting.formatNumber(r[0]||"0")+"."+(r[1]||"00")},o.noExponentsStr=function(t){t=v_utilities_1.VUtilities.makeString(t);var e=parseFloat(t),r=String(e).split(/[eE]/);if(1===r.length)return r[0];var i="",n=e<0?"-":"",a=r[0].replace(".",""),s=Number(r[1])+1;if(s<0){for(i=n+"0.";s++;)i+="0";return i+a.replace(/^\-/,"")}for(s-=a.length;s--;)i+="0";return a+i},o.decimalToStr=function(t,e){void 0===e&&(e=o.ROUND_TO_DEFAULT),t=v_utilities_1.VUtilities.makeString(t);var r=parseFloat(t),i=o.noExponentsStr(r);if(e=o.isNumeric(e)?parseInt(e.toString(),10):o.ROUND_TO_DEFAULT,"NaN"===i)return null;var n=o.reverse(i).split("").findIndex(function(t){return 0!==parseInt(t,10)||"."===t});return-1===n?"0.00":(i=i.substring(0,i.length+n),!/\./.test(i)||(_.last(i.split("."))||"").length<3||"."===i.slice(-1)?i=parseFloat(i).toFixed(2):(!/\./.test(i)||7<(_.last(i.split("."))||"").length||"."===i.slice(-1))&&(i=o.roundToDecimal(parseFloat(i),e).toString()),i)},o.decimalToPercStr=function(t){return(o.decimalToStr(parseFloat(mathjs.multiply(mathjs.number(v_utilities_1.VUtilities.parseBigOrZero(t)),mathjs.bignumber(100)).toString()))||"0.0")+"%"},o.percToDecimal=function(t){return parseFloat(mathjs.divide(mathjs.number(v_utilities_1.VUtilities.parseBigOrZero(t)),mathjs.bignumber(100)).toString())},o.percentThreshold=function(t,e){return o.isNumeric(t)?(t=v_utilities_1.VUtilities.makeString(t),50===parseFloat(t)?"a majority":66.66===o.roundToDecimal(parseFloat(t),2)||66.67===o.roundToDecimal(parseFloat(t),2)?"at least two-thirds":33.3===o.roundToDecimal(parseFloat(t),1)?"at least one-third":"at least "+t+"%"):t},o.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},o.decimalToPercentage=function(t,e){return void 0===e&&(e=2),(100*(parseFloat(v_utilities_1.VUtilities.makeString(t))||0)).toFixed(e)},o.roundToDecimal=function(t,e){if(void 0===e&&(e=2),e=o.isNumeric(e)?parseInt(v_utilities_1.VUtilities.makeString(e),10):2,o.isNumeric(t)){var r=v_utilities_1.VUtilities.parseBigOrZero(t),i=mathjs.divide(mathjs.round(mathjs.multiply(mathjs.number(r),mathjs.pow(10,e))),mathjs.pow(10,e));return 0<=e&&(i=mathjs.format(i,{notation:"fixed",precision:e})),i=parseFloat(i.toString())}return parseFloat(v_utilities_1.VUtilities.makeString(t))},o.numberToWords=function(t){return vn2w.numberToWords(t)},o.coerceToDate=function(e,t){try{return moment(v_utilities_1.VUtilities.enumDate(e)||0).utc()}catch(t){return e}},o.formatDate=function(t,e){var r;return void 0===e&&(e={utc:!1}),t&&0<t.toString().length?(r="number"==typeof t?moment.unix(t):t.toString().trim().match(/^\d{4}-\d{2}\d{2}$/)?moment(t,"YYYY-MM-DD"):t.toString().trim().match(/^\d{8}$/)?moment(t,"YYYYMMDD"):moment(t),e.utc?r.utc().format("LL"):r.format("LL")):t},o.formatUTCDatetimeStamp=function(t,e){var r="MMM D, YYYY, HH:mm:ss ZZ";return e&&(r="M"+r),v_utilities_1.VUtilities.isNumeric(t)?moment.utc(t).format(r):r},o.formatUTCDatetime=function(t,e){var r=v_utilities_1.VUtilities.enumDate(t);return o.formatUTCDatetimeStamp(r,e)},o.formatDateSentence=function(e,t){if(s.isBlank(e))return e;e=o.coerceToDate(e,t);try{return moment(e).format("Do")+" day of "+moment(e).format("MMMM, YYYY")}catch(t){return e}},o.labelize=function(t){return s.titleize(o.hintize(t))},o.hintize=function(t){return s.capitalize(s.underscored((t||"").toString()).split(/\_|(\W)/).join(" ").replace(/\s+/g," "))},o.titleize=function(t){return s.isBlank(t)?t:s.titleize(t.toString().trim())},o.toRoman=function(a){var s="";return 0===(a=a||0)||_.each(o.ORDERED_ROMAN_MAP,function(t){var e=t[0],r=t[1],i=Math.floor(a/e),n=a%e;s+=r.repeat(i),a=n}),s},o.toRomanette=function(t){return o.toRoman(t=t||0).toLowerCase()},o.toAlpha=function(t,e){t=parseInt(v_utilities_1.VUtilities.makeString(t)||"0",10),e=e||"";for(;0<t;){var r=Math.floor((t-1)/26);e=o.ALPHABET[(t-1)%26]+e,t=r}return e},o.toOrdinal=function(t){var e=["th","st","nd","rd"],r=t%100;return t+(e[(r-20)%10]||e[r]||e[0])},o.joinArray=function(t){if(t&&o.isArray(t)){var e=_.filter(t,function(t){return!s.isBlank(t)});return o.smart_array_values(e).join(", ")}},o.joinArray2d=function(t){if(t&&o.isArray(t))return o.smart_array2d_values(t).map(function(t){return o.isArray(t)?t.join(" - "):t.toString()}).join("; ")},o.joinArrayOfHashesValues=function(t){if(t&&o.isArray(t))return o.smart_array_of_hash_values(t).map(function(t){return o.isObject(t)?_.map(t,function(t,e){return o.smartFormatValue(t)}).join(", "):o.smartFormatValue(t)}).join("; ")},o.hashToLines=function(t){return _.map(o.smart_hash_values(t),function(t,e){return v_utilities_1.VUtilities.makeString(e)+": "+v_utilities_1.VUtilities.makeString(t)})},o.hashesToLines=function(t){return o.isArray(t)?t.map(function(t){return o.hash_to_lines(t)}).join("; "):t},o.smartRecursiveFormat=function(t){var r;return t&&o.isObject(t)?(r=_.defaults({},t),_.each(t,function(t,e){r[e]=o.smartRecursiveFormat(t)})):t&&o.isArray(t)?(r=[],t.forEach(function(t){r.push(o.smartRecursiveFormat(t))})):r=o.smartFormatValue(t),r},o.smartFormatValue=function(t){var e=t;return o.isDate(t)||moment.isMoment(t)||"string"==typeof t&&/^\d\d\d\d\-\d\d\-\d\d$/.test(t)?e=o.formatDate(t):"number"==typeof t&&(e=o.variableInteger(t)),e},o.valueOrHolder=function(t){return s.isBlank(t)||0===t.toString().replace(/\s/gi,"").length?"_________________":t},o.arrayToHumanList=function(t,r){if(r=r||{},!o.isArray(t))return t;_.defaults(r,{separator:",",junctive:"and",serial:null});var i=r.serial||";"===r.separator&&!o.isFalse(r.serial)?r.separator+" ":" ",n=t.length,a="";return _.each(t,function(t,e){0!==e&&(a+=2===n?" "+r.junctive+" ":2<n&&e<n-1?r.separator+" ":i+r.junctive+" "),a+=t}),a},o.jsFormat=function(e,t){return o.isBlank(t)||(t=[].concat(t||[]),_.each(t,function(t){try{e=o.hasOwnProperty(t)?o[t](e):e}catch(t){return o.coerceToString(e)}})),o.coerceToString(e)},o.jsFormatVField=function(t,e,r){if(!e||o.isBlank(r))return t;var i=[];return(r||[]).forEach(function(t){return i=i.concat((e||{})[t]||[])}),s.isBlank(i)?t:o.jsFormat(t,i)},o.jsFormatVFields=function(t,i,n){if(s.isBlank(t)||!i)return t;var a={};return _.each(t,function(t,e){var r=(i||{})[e]||{};a[e]=o.jsFormatVField(t,r,n)}),a},o.jsInputProcess=function(t,e,r){return o.jsFormatVFields(t,e,["jsInputProcessors"])},o.jsDisplay=function(t,e){return o.jsFormatVFields(t,e,["js_formatters"])},o.jsInputDisplay=function(t,e){return o.jsFormatVFields(t,e,["jsInputProcessors","js_formatters"])},o.isBlank=v_utilities_1.VUtilities.isBlank,o.isObject=v_utilities_1.VUtilities.isObject,o.isArray=v_utilities_1.VUtilities.isArray,o.isDate=v_utilities_1.VUtilities.isDate,o.isString=v_utilities_1.VUtilities.isString,o.isNumeric=v_utilities_1.VUtilities.isNumeric,o.isTrue=v_utilities_1.VUtilities.isTrue,o.isFalse=v_utilities_1.VUtilities.isFalse,o.isTrueOrFalse=v_utilities_1.VUtilities.isTrueOrFalse,o.coerceToString=v_utilities_1.VUtilities.coerceToString,o.reverse=v_utilities_1.VUtilities.reverse,o.string_to_decimal=o.stringToDecimal,o.string_to_integer=o.stringToInteger,o.join_array=o.joinArray,o.join_array2d=o.joinArray2d,o.join_array_of_hashes_values=o.joinArrayOfHashesValues,o.hash_to_lines=o.hashToLines,o.hashes_to_lines=o.hashesToLines,o.smart_array_values=o.smartRecursiveFormat,o.smart_hash_values=o.smartRecursiveFormat,o.smart_array2d_values=o.smartRecursiveFormat,o.smart_array_of_hash_values=o.smartRecursiveFormat,o.smart_format_value=o.smartFormatValue,o}();exports.VTools=VTools,exports.default=VTools;
