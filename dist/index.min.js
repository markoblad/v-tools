"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _=require("lodash"),s=require("underscore.string"),pluralize=require("pluralize"),moment=require("moment"),math=require("mathjs"),accounting=require("accounting"),vn2w=require("v-number-to-words"),VTools=function(){function r(){}return Object.defineProperty(r,"ROUND_TO_DEFAULT",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ALPHABET",{get:function(){return["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ROMAN_MAP",{get:function(){return{1000:"M",900:"CM",500:"D",400:"CD",100:"C",90:"XC",50:"L",40:"XL",10:"X",9:"IX",5:"V",4:"IV",1:"I"}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ORDERED_ROMAN_MAP",{get:function(){return[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIOD_FREQUENCY_LEGEND",{get:function(){return{1:"One year",2:"Six months",3:"Four months",4:"Three months",6:"Two months",8:"Month and a half",12:"One month",24:"Half month",26:"Two weeks",52:"Week",364:"One day",365:"One day",366:"One day"}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ANNUAL_FREQUENCY_TO_LABEL",{get:function(){return{1:"Annual",4:"Quarterly",12:"Monthly"}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIOD_FREQ_OPTIONS",{get:function(){return{Annual:1,"Semi-Annual":2,Quarter:4,Month:8}},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ALL_FISCAL_PERIODS",{get:function(){return["N/A","FY","FYTD","Q1","Q2","Q3","Q4","H1","H2","9M","T1M","T3M","T9M","TSM","TTM","M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12","ASOF"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIODLY",{get:function(){return["annually","semi-annually","quarterly","bi-monthly","monthly","semi-monthly","bi-weekly","weekly","daily","hourly"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PERIODS",{get:function(){return["years","semi-years","quarters","bi-months","months","semi-months","bi-weeks","weeks","days","hours","minutes","seconds"]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"SINGULAR_PERIODS",{get:function(){return _.map(r.PERIODS,function(r){return pluralize(r,1)})},enumerable:!0,configurable:!0}),r.isBlank=function(t){return null==t||void 0==t||("string"==typeof t||"number"==typeof t?s.isBlank(t.toString()):r.isArray(t)?0===t.length:r.isObject(t)?0===Object.getOwnPropertyNames(t).length:s.isBlank(r.makeString(t)))},r.isObject=function(r){return"[object Object]"===Object.prototype.toString.call(r)},r.isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)},r.isDate=function(r){return"[object Date]"===Object.prototype.toString.call(r)},r.isString=function(r){return"string"==typeof r},r.isNumeric=function(t){return!r.isObject(t)&&!r.isArray(t)&&!isNaN(parseFloat(t))&&isFinite(t)},r.isTrue=function(r){if(void 0===r||null===r)return!1;var t=["yes","y","true","t","1","on"];return _.includes(t,r.toString().toLowerCase())},r.isFalse=function(r){if(void 0===r||null===r)return!1;var t=["no","n","false","f","0","off"];return _.includes(t,r.toString().toLowerCase())},r.isTrueOrFalse=function(t){return r.isTrue(t)||r.isFalse(t)},r.eachSlice=function(r,t,e){void 0===t&&(t=1);for(var n=0,a=r.length;n<a;n+=t)e(r.slice(n,n+t))},r.arraySum=function(t){return t&&r.isArray(t)?_.reduce(t,function(r,t){var e=typeof t;return!t||"string"!==e&&"number"!==e||!isFinite(t)&&t!==1/0?r:r+parseFloat(t)},0):0},r.arrayItemCounts=function(r){return _.reduce(r||[],function(r,t){return r[t]=r[t]||0,r[t]+=1,r},{})},r.arraySort=function(r){return void 0===r&&(r=[]),_.map(r,function(r){return"Infinity"===r?1/0:"-Infinity"===r?-1/0:r}).sort(function(r,t){return r-t})},r.arrayClosest=function(t,e){if(void 0===e&&(e=[]),!r.isNumeric(t)||!r.isArray(e)||0===e.length)return null;t=parseFloat(t.toString());var n=parseFloat(e[0].toString()),a=Math.abs(t-n);return e.forEach(function(e){if(!r.isBlank(e)){var o=parseFloat(e.toString()),i=Math.abs(t-o);r.isNumeric(e)&&i<a&&(a=i,n=o)}}),n},r.arrayClosestBelowOrAbove=function(t,e,n,a){if(void 0===e&&(e=[]),!r.isNumeric(t)||!r.isArray(e)||0===e.length)return null;t=parseFloat(t.toString());var o=_.chain(e).uniq().compact().map(function(r){return parseFloat(r.toString())}).value();o=r.arraySort(o),a||(o=_.reverse(o));var i,u=null;return i=n?a?function(r,t){return r>=t}:function(r,t){return r<=t}:a?function(r,t){return r>t}:function(r,t){return r<t},_.find(o,function(e){var n=r.isNumeric(e)&&i(e,t);return n&&(u=e),n}),u},r.arrayClosestBelow=function(t,e){return void 0===e&&(e=[]),r.arrayClosestBelowOrAbove(t,e,!1,!1)},r.arrayClosestAbove=function(t,e){return void 0===e&&(e=[]),r.arrayClosestBelowOrAbove(t,e,!1,!0)},r.arrayEqualOrClosestBelow=function(t,e){return void 0===e&&(e=[]),r.arrayClosestBelowOrAbove(t,e,!0,!1)},r.arrayEqualOrClosestAbove=function(t,e){return void 0===e&&(e=[]),r.arrayClosestBelowOrAbove(t,e,!0,!0)},r.hasRangeOverlap=function(t,e,n){return void 0===n&&(n={}),r.isTrue(n.sort)&&(t=t.sort(),e=e.sort()),t&&e&&2===t.length&&2===e.length&&(r.isTrue(n.strict)?t[0]!==t[1]&&(t[0]<e[1]&&t[1]>e[0]||e[0]<t[1]&&e[1]>t[0]):t[0]<=e[1]&&e[0]<=t[1])},r.makeString=function(r){return null==r?"":""+r},r.coerceToString=function(r){return _.some(["[object Undefined]","[object Null]"],function(t){return Object.prototype.toString.call(r)===t})?"":r.toString()},r.pluralize=function(r){return pluralize.apply(this,arguments)},r.reverse=function(r){return r.split("").reverse().join("")},r.ambipluralize=function(t){return s.isBlank(t)?t:(t=r.pluralize(t),/ies$/i.test(t)?t=t.replace(/ies$/i,"(ies)"):/s$/i.test(t)&&(t=t.replace(/s$/i,"(s)")),t)},r.normalizeString=function(r){return(r||"").toString().replace(/[\s\'\.\,\:\;\/\(\)\[\]\-\#\@\!\$\%\^\&\*\+\=\"\?\<\>\~\`]+/g,"").replace(/^\d/,function(r){return"pre_"+r[0]})},r.parseZeroPaddedInt=function(r){if(s.isBlank(r)||0===r||"0"===r||s.isBlank(r.toString().replace(/0/g,"")))return 0;r=r.toString();var t=r.search(/(?!0)/);return parseInt(r.slice(t,r.length),10)},r.stringToDecimal=function(r){return parseFloat((r||0).toString().trim().replace(/[^\d\.]/g,""))},r.stringToInteger=function(t){return parseInt(r.stringToDecimal(t).toString(),10)},r.parseBigOrZero=function(t){return math.bignumber(r.isNumeric(t)?t:0)},r.variableCurrency=function(t,e){if(t=r.makeString(t),r.roundToDecimal(parseFloat(t),2)===parseFloat(t))return accounting.formatMoney(t,e);var n=r.decimalToStr(parseFloat(t)),a=n?(n.split(".")[1]||"").length:2;return 1===a&&(a=2),accounting.formatMoney(t,e,a)},r.variableInteger=function(t){if(t=r.makeString(t),!r.isNumeric(t))return t;if(r.roundToDecimal(parseFloat(t),0)===parseFloat(t))return accounting.formatNumber(t);var e=r.decimalToStr(parseFloat(t));if(!e)return e;var n=e.split(".");return accounting.formatNumber(n[0]||"0")+"."+(n[1]||"00")},r.noExponentsStr=function(t){t=r.makeString(t);var e=parseFloat(t),n=String(e).split(/[eE]/);if(1===n.length)return n[0];var a="",o=e<0?"-":"",i=n[0].replace(".",""),u=Number(n[1])+1;if(u<0){for(a=o+"0.";u++;)a+="0";return a+i.replace(/^\-/,"")}for(u-=i.length;u--;)a+="0";return i+a},r.decimalToStr=function(t,e){void 0===e&&(e=r.ROUND_TO_DEFAULT),t=r.makeString(t);var n=parseFloat(t),a=r.noExponentsStr(n);if(e=r.isNumeric(e)?parseInt(e.toString(),10):r.ROUND_TO_DEFAULT,"NaN"===a)return null;var o=r.reverse(a).split("").findIndex(function(r){return 0!==parseInt(r,10)||"."===r});return-1===o?"0.00":(a=a.substring(0,a.length+o),!/\./.test(a)||(_.last(a.split("."))||"").length<3||"."===a.slice(-1)?a=parseFloat(a).toFixed(2):(!/\./.test(a)||(_.last(a.split("."))||"").length>7||"."===a.slice(-1))&&(a=r.roundToDecimal(parseFloat(a),e).toString()),a)},r.decimalToPercStr=function(t){return(r.decimalToStr(parseFloat(math.multiply(r.parseBigOrZero(t),math.bignumber(100)).toString()))||"0.0")+"%"},r.percToDecimal=function(t){return parseFloat(math.divide(r.parseBigOrZero(t),math.bignumber(100)).toString())},r.percentThreshold=function(t,e){if(!r.isNumeric(t))return t;t=r.makeString(t);return 50===parseFloat(t)?"a majority":66.66===r.roundToDecimal(parseFloat(t),2)||66.67===r.roundToDecimal(parseFloat(t),2)?"at least two-thirds":33.3===r.roundToDecimal(parseFloat(t),1)?"at least one-third":"at least "+t+"%"},r.numberWithCommas=function(r){return r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},r.decimalToPercentage=function(t,e){return void 0===e&&(e=2),(100*(parseFloat(r.makeString(t))||0)).toFixed(e)},r.roundToDecimal=function(t,e){if(void 0===e&&(e=2),e=r.isNumeric(e)?parseInt(r.makeString(e),10):2,r.isNumeric(t)){var n=r.parseBigOrZero(t),a=math.divide(math.round(math.multiply(n,math.pow(10,e))),math.pow(10,e));return e>=0&&(a=math.format(a,{notation:"fixed",precision:e})),a=parseFloat(a.toString())}return parseFloat(r.makeString(t))},r.numberToWords=function(r){return vn2w.numberToWords(r)},r.enumDate=function(r){return s.isBlank(r)?null:"number"==typeof r?r:parseInt(moment.utc(r).format("x"),10)},r.newUTCDateTimeStamp=function(){return r.enumDate(new Date)},r.coerceToDate=function(t,e){try{return moment.utc(r.enumDate(t)||0)}catch(r){return t}},r.formatDate=function(r,t){void 0===t&&(t={utc:!1});var e;return r&&r.toString().length>0?(e="number"==typeof r?moment.unix(r):r.toString().trim().match(/^\d{4}-\d{2}\d{2}$/)?moment(r,"YYYY-MM-DD"):r.toString().trim().match(/^\d{8}$/)?moment(r,"YYYYMMDD"):moment(r),t.utc?e.utc().format("LL"):e.format("LL")):r},r.formatDateSentence=function(t,e){if(s.isBlank(t))return t;t=r.coerceToDate(t,e);try{return moment(t).format("Do")+" day of "+moment(t).format("MMMM, YYYY")}catch(r){return t}},r.labelize=function(t){return s.titleize(r.hintize(t))},r.hintize=function(r){return s.capitalize(s.underscored((r||"").toString()).split(/\_|(\W)/).join(" ").replace(/\s+/g," "))},r.titleize=function(r){return s.isBlank(r)?r:s.titleize(r.toString().trim())},r.toRoman=function(t){t=t||0;var e="";return 0===t?e:(_.each(r.ORDERED_ROMAN_MAP,function(r){var n=r[0],a=r[1],o=Math.floor(t/n),i=t%n;e+=a.repeat(o),t=i}),e)},r.toRomanette=function(t){return t=t||0,r.toRoman(t).toLowerCase()},r.toAlpha=function(t,e){t=parseInt(r.makeString(t)||"0",10),e=e||"";for(;t>0;){var n=Math.floor((t-1)/26),a=(t-1)%26;e=r.ALPHABET[a]+e,t=n}return e},r.toOrdinal=function(r){var t=["th","st","nd","rd"],e=r%100;return r+(t[(e-20)%10]||t[e]||t[0])},r.joinArray=function(t){if(t&&r.isArray(t)){var e=_.filter(t,function(r){return!s.isBlank(r)});return r.smart_array_values(e).join(", ")}},r.joinArray2d=function(t){if(t&&r.isArray(t))return r.smart_array2d_values(t).map(function(t){return r.isArray(t)?t.join(" - "):t.toString()}).join("; ")},r.joinArrayOfHashesValues=function(t){if(t&&r.isArray(t))return r.smart_array_of_hash_values(t).map(function(t){return r.isObject(t)?_.map(t,function(t,e){return r.smartFormatValue(t)}).join(", "):r.smartFormatValue(t)}).join("; ")},r.hashToLines=function(t){return _.map(r.smart_hash_values(t),function(t,e){return r.makeString(e)+": "+r.makeString(t)})},r.hashesToLines=function(t){return r.isArray(t)?t.map(function(t){return r.hash_to_lines(t)}).join("; "):t},r.smartRecursiveFormat=function(t){var e;return t&&r.isObject(t)?(e=_.defaults({},t),_.each(t,function(t,n){e[n]=r.smartRecursiveFormat(t)})):t&&r.isArray(t)?(e=[],t.forEach(function(t){e.push(r.smartRecursiveFormat(t))})):e=r.smartFormatValue(t),e},r.smartFormatValue=function(t){var e=t;return r.isDate(t)||moment.isMoment(t)||"string"==typeof t&&/^\d\d\d\d\-\d\d\-\d\d$/.test(t)?e=r.formatDate(t):"number"==typeof t&&(e=r.variableInteger(t)),e},r.valueOrHolder=function(r){return s.isBlank(r)||0===r.toString().replace(/\s/gi,"").length?"_________________":r},r.arrayToHumanList=function(t,e){if(e=e||{},!r.isArray(t))return t;_.defaults(e,{separator:",",junctive:"and",serial:null});var n=e.serial||";"===e.separator&&!r.isFalse(e.serial)?e.separator+" ":" ",a=t.length,o="";return _.each(t,function(r,t){0!==t&&(o+=2===a?" "+e.junctive+" ":a>2&&t<a-1?e.separator+" ":n+e.junctive+" "),o+=r}),o},r.jsFormat=function(t,e){return r.isBlank(e)?r.coerceToString(t):(e=[].concat(e||[]),_.each(e,function(e){try{t=r.hasOwnProperty(e)?r[e](t):t}catch(e){return r.coerceToString(t)}}),r.coerceToString(t))},r.jsFormatVField=function(t,e,n){if(!e||r.isBlank(n))return t;var a=[];return(n||[]).forEach(function(r){return a=a.concat((e||{})[r]||[])}),s.isBlank(a)?t:r.jsFormat(t,a)},r.jsFormatVFields=function(t,e,n){if(s.isBlank(t)||!e)return t;var a={};return _.each(t,function(t,o){var i=(e||{})[o]||{};a[o]=r.jsFormatVField(t,i,n)}),a},r.jsInputProcess=function(t,e,n){return r.jsFormatVFields(t,e,["jsInputProcessors"])},r.jsDisplay=function(t,e){return r.jsFormatVFields(t,e,["js_formatters"])},r.jsInputDisplay=function(t,e){return r.jsFormatVFields(t,e,["jsInputProcessors","js_formatters"])},r.string_to_decimal=r.stringToDecimal,r.string_to_integer=r.stringToInteger,r.join_array=r.joinArray,r.join_array2d=r.joinArray2d,r.join_array_of_hashes_values=r.joinArrayOfHashesValues,r.hash_to_lines=r.hashToLines,r.hashes_to_lines=r.hashesToLines,r.smart_array_values=r.smartRecursiveFormat,r.smart_hash_values=r.smartRecursiveFormat,r.smart_array2d_values=r.smartRecursiveFormat,r.smart_array_of_hash_values=r.smartRecursiveFormat,r.smart_format_value=r.smartFormatValue,r}();exports.VTools=VTools,exports.default=VTools;
